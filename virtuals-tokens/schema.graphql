type TokenLaunch @entity {
  id: ID!
  address: String! # The launched token address as string for search
  addressBytes: Bytes! # The raw token address bytes
  createdAtBlock: BigInt!
  createdAtTx: Bytes!
  tokenCreator: String! # Creator address as string for search
  tokenCreatorBytes: Bytes! # The raw creator address bytes
  timestamp: BigInt!
  
  # Launch function parameters
  name: String!
  ticker: String!
  cores: [Int!]!
  description: String!
  imageUrl: String!
  urls: [String!]!
  purchaseAmount: BigInt!
}

type Swap @entity(immutable: true) {
  id: Bytes! # Transaction hash
  timestamp: BigInt!
  block: BigInt!
  trader: Bytes!
  tokenIn: Bytes!
  tokenOut: Bytes!
  amountIn: BigInt!
  amountOut: BigInt!
  feeAmount: BigInt!
  feeRecipient: Bytes!
  type: String! # "BUY" or "SELL"
}

type TokenSupply @entity {
  id: Bytes!          # Token address
  circulatingSupply: BigDecimal!
  lastUpdateBlock: BigInt!
  lastUpdateTimestamp: BigInt!
}

type TradeSnapshot @entity(immutable: true) {
  id: Bytes!          # Concatenated token address, timestamp, and tx hash
  token: Bytes!
  timestamp: BigInt!
  transaction: Bytes!
  trader: Bytes!
  
  # Trade data
  type: String!      # "BUY" or "SELL"
  volumeToken: BigDecimal!
  volumeUSD: BigDecimal!
  priceUSD: BigDecimal!
  
  # Market state at time of trade
  marketCap: BigDecimal!
  circulatingSupply: BigDecimal!
}

type TokenDayStats @entity {
  id: Bytes!          # Concatenated token address and day timestamp
  token: Bytes!
  date: BigInt!
  
  # Price metrics
  openPrice: BigDecimal!
  closePrice: BigDecimal!
  highPrice: BigDecimal!
  lowPrice: BigDecimal!
  priceChange: BigDecimal! # Percentage change from previous day
  
  # Volume metrics
  volumeToken: BigDecimal!
  volumeUSD: BigDecimal!
  volumeChange: BigDecimal! # 24h change
  
  # Trade metrics
  txCount: Int!
  buyCount: Int!
  sellCount: Int!
  uniqueTraderCount: Int!
  uniqueTraders: [Bytes!]!
  
  # Market metrics
  marketCap: BigDecimal!
  circulatingSupply: BigDecimal!
  
  # Additional metrics
  averageTradeSize: BigDecimal!
  largestTrade: BigDecimal!
  smallestTrade: BigDecimal!
  volatility: BigDecimal!     # Standard deviation of price changes
  buyRatio: BigDecimal!       # buyCount / txCount
  averageHoldTime: BigInt!    # Average time between buys and sells
  traderRetention: BigDecimal! # Returning traders / total traders
  
  # Enhanced price analytics
  priceVolatility: BigDecimal!      # Standard deviation of price changes within the day
  priceMovementCount: Int!          # Number of price direction changes
  longestPriceUptrend: Int!         # Longest consecutive price increase streak
  longestPriceDowntrend: Int!       # Longest consecutive price decrease streak
  averagePriceImpact: BigDecimal!   # Average price change per trade
  volumeWeightedPrice: BigDecimal!   # VWAP for more accurate price representation
  
  # Enhanced volume analytics
  volumeDistribution: [BigDecimal!]! # Distribution of trade sizes in percentiles (10 values for deciles)
  largeTradeCount: Int!             # Number of trades above average size
  buyVolumeRatio: BigDecimal!       # Buy volume / total volume
  
  # Market health metrics
  liquidityScore: BigDecimal!       # Based on trade size impact on price
  marketEfficiency: BigDecimal!     # Price consistency across trades
  buyPressure: BigDecimal!          # Buy volume vs sell volume trend
  marketDepth: BigDecimal!          # Average trade size possible without significant price impact
  
  # Time-based analytics
  hourlyVolume: [BigDecimal!]!      # Volume distribution by hour (24 values)
  hourlyTrades: [Int!]!             # Trade count distribution by hour (24 values)
  peakTradingHour: Int!             # Hour with highest volume
  quietTradingHour: Int!            # Hour with lowest volume
}

type TokenTraderStats @entity {
  id: Bytes! # Concatenated token address, day timestamp, and trader address
  token: Bytes!
  trader: Bytes!
  date: BigInt!
  
  # Trading activity
  txCount: Int!
  volumeToken: BigDecimal!
  volumeUSD: BigDecimal!
  
  # Trade types
  buyCount: Int!
  sellCount: Int!
  
  # Profitability metrics
  realizedPnL: BigDecimal!          # Realized profit/loss in USD
  averageEntryPrice: BigDecimal!
  averageExitPrice: BigDecimal!
  holdTime: BigInt!                 # Time between first and last trade of the day
  
  # Enhanced trader analytics
  tradeFrequency: BigDecimal!       # Average time between trades
  profitabilityRatio: BigDecimal!   # Profitable trades / total trades
  averagePositionSize: BigDecimal!  # Average amount per trade
  maxDrawdown: BigDecimal!          # Largest peak-to-trough decline
  winningStreak: Int!               # Longest streak of profitable trades
  losingStreak: Int!                # Longest streak of unprofitable trades
}

type _Schema_
@fulltext(
  name: "tokenLaunchSearch"
  language: en
  algorithm: rank
  include: [
    {
      entity: "TokenLaunch",
      fields: [
        { name: "address" },
        { name: "tokenCreator" },
        { name: "name" },
        { name: "ticker" },
        { name: "description" }
      ]
    }
  ]
)
